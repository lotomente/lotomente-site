
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LotoMente - Palpite</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-purple-800 to-indigo-700 min-h-screen flex items-center justify-center text-white">

  <main class="bg-white text-gray-900 p-8 rounded-xl shadow-2xl w-full max-w-xl text-center space-y-6">
    <h1 class="text-3xl font-bold">🔮 Gerador de Palpites</h1>
    <p id="statusUsuario" class="text-sm text-gray-600"></p>

    <div class="space-y-4">
      <button onclick="if (podeGerarPalpite('mega')) gerarPalpiteMega()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow">Gerar Palpite Mega-Sena</button>
      <button onclick="if (podeGerarPalpite('quina')) gerarPalpiteQuina()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded shadow">Gerar Palpite Quina</button>
      <p id="resultado" class="mt-4 text-xl font-mono text-gray-800"></p>
    </div>

    <a href="painel.html" class="inline-block mt-6 text-purple-700 font-semibold hover:underline">⬅️ Voltar ao Painel</a>
  </main>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDNBIggOpIxDknGvxVnutLc79xCc9CB_G4",
      authDomain: "lotomente.firebaseapp.com",
      projectId: "lotomente",
      storageBucket: "lotomente.firebasestorage.app",
      messagingSenderId: "1045885993524",
      appId: "1:1045885993524:web:835f0ca416c2b4bf6ac061"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let usuarioLogado = null;

    auth.onAuthStateChanged(user => {
      if (user) {
        usuarioLogado = user;
        document.getElementById("statusUsuario").innerText = "Logado como: " + user.email;
      } else {
        usuarioLogado = null;
        document.getElementById("statusUsuario").innerText = "Você precisa estar logado para salvar palpites.";
      }
    });

    function gerarPalpiteMega() {
      const numeros = Array.from({ length: 60 }, (_, i) => (i + 1).toString().padStart(2, '0'));
      const shuffle = arr => arr.sort(() => 0.5 - Math.random());
      const dezenas = shuffle(numeros).slice(0, 6).sort((a, b) => a - b);

      document.getElementById('resultado').innerText = "Mega-Sena: " + dezenas.join(" – ");

      if (!usuarioLogado) {
        alert("Faça login para salvar seus palpites.");
        return;
      }

      db.collection("palpites").add({
        dezenas: dezenas,
        geradoEm: new Date(),
        uid: usuarioLogado.uid,
        email: usuarioLogado.email
      }).then(() => {
        console.log("Palpite da Mega salvo.");
      }).catch((error) => {
        console.error("Erro ao salvar palpite:", error);
      });
    }

    function gerarPalpiteQuina() {
      const numeros = Array.from({ length: 80 }, (_, i) => (i + 1).toString().padStart(2, '0'));
      const shuffle = arr => arr.sort(() => 0.5 - Math.random());
      const dezenas = shuffle(numeros).slice(0, 5).sort((a, b) => a - b);

      document.getElementById('resultado').innerText = "Quina: " + dezenas.join(" – ");

      if (!usuarioLogado) {
        alert("Faça login para salvar seus palpites.");
        return;
      }

      db.collection("palpites_quina").add({
        dezenas: dezenas,
        geradoEm: new Date(),
        uid: usuarioLogado.uid,
        email: usuarioLogado.email
      }).then(() => {
        console.log("Palpite da Quina salvo.");
      }).catch((error) => {
        console.error("Erro ao salvar palpite:", error);
      });
    }
  </script>

  <!-- Limite mensal para plano gratuito -->
  <script>
    function podeGerarPalpite(tipo) {
      const plano = localStorage.getItem('planoSelecionado') || 'gratis';
      const hoje = new Date();
      const chaveMes = `limite_mes_${hoje.getFullYear()}-${(hoje.getMonth()+1).toString().padStart(2, '0')}`;
      let usado = parseInt(localStorage.getItem(chaveMes)) || 0;

      if (plano === 'mensal' || plano === 'trimestral') {
        return true;
      }

      if (usado >= 2) {
        alert("❌ Você atingiu o limite de 2 palpites gratuitos neste mês. Faça upgrade para continuar usando.");
        return false;
      }

      localStorage.setItem(chaveMes, usado + 1);
      return true;
    }
  </script>

</body>
</html>
